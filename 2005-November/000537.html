<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [fetchmail-devel] [PATCH] Re: Tried to install 6.2.9-rc8 --with-ssl
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/fetchmail-devel/2005-November/index.html" >
   <LINK REL="made" HREF="mailto:fetchmail-devel%40lists.berlios.de?Subject=Re%3A%20%5Bfetchmail-devel%5D%20%5BPATCH%5D%20Re%3A%20Tried%20to%20install%206.2.9-rc8%20--with-ssl&In-Reply-To=%3C20051119111747.GA26479%40session.bombay.retortsoft.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000536.html">
   <LINK REL="Next"  HREF="000538.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[fetchmail-devel] [PATCH] Re: Tried to install 6.2.9-rc8 --with-ssl</H1>
    <B>Sunil Shetye</B> 
    <A HREF="mailto:fetchmail-devel%40lists.berlios.de?Subject=Re%3A%20%5Bfetchmail-devel%5D%20%5BPATCH%5D%20Re%3A%20Tried%20to%20install%206.2.9-rc8%20--with-ssl&In-Reply-To=%3C20051119111747.GA26479%40session.bombay.retortsoft.com%3E"
       TITLE="[fetchmail-devel] [PATCH] Re: Tried to install 6.2.9-rc8 --with-ssl">shetye at bombay.retortsoft.com
       </A><BR>
    <I>Sat Nov 19 12:17:47 CET 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000536.html">[fetchmail-devel] Contents of file `fetchmail-6.2.9-rc9.sq.po'
</A></li>
        <LI>Next message: <A HREF="000538.html">[fetchmail-devel] [PATCH] Re: Tried to install 6.2.9-rc8 --with-ssl
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#537">[ date ]</a>
              <a href="thread.html#537">[ thread ]</a>
              <a href="subject.html#537">[ subject ]</a>
              <a href="author.html#537">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Quoting from Sunil Shetye's mail on Sat, Nov 12, 2005:
&gt;<i> Quoting from Peter Church's mail on Fri, Nov 11, 2005 at 02:42:05PM -0000:
</I>&gt;<i> &gt;   Like the title says :( I have tried to install this version and come up  
</I>&gt;<i> &gt; with the following
</I>&gt;<i> &gt; error. I had a previous version installed however I deleted the old  
</I>&gt;<i> &gt; binaries before I started...
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; bash-3.00# make install
</I>&gt;<i> 
</I>&gt;<i> ...
</I>&gt;<i> 
</I>&gt;<i> &gt; test -z &quot;&quot; || /bin/sh ./mkinstalldirs &quot;&quot;
</I>&gt;<i> &gt;  ./install-sh -c -m 644 'fetchmailconf.py' '/fetchmailconf.py'
</I>&gt;<i> 
</I>&gt;<i> It is installing fetchmailconf.py on the root directory! This means
</I>&gt;<i> that pythondir and/or pyexecdir are not set correctly.
</I>&gt;<i> 
</I>&gt;<i> &gt; ./py-compile: Missing argument to --basedir.
</I>&gt;<i> &gt; *** Error code 1
</I>&gt;<i> 
</I>&gt;<i> Could you run these commands and tell the output?
</I>
If python is missing, &quot;make install&quot; gives the above errors. It seems
that the configure script accepts a missing python, but the Makefile
generated by configure cannot cope with a missing python.

This patch now avoids installing fetchmailconf* if python is missing.

This patch also fixes specgen.sh to handle the missing python. If
python is missing, with_python should be set to 0 manually and the
spec file should work. The spec file has been cleaned up too.

To check the patch, python needs to be removed from the system first
as there is no configure option to disable checking the location of
python.

-- 
Sunil Shetye.
-------------- next part --------------
Index: fetchmail/configure.ac
===================================================================
--- fetchmail/configure.ac	(revision 4465)
+++ fetchmail/configure.ac	(working copy)
@@ -18,6 +18,7 @@
 
 dnl the : states that python is optional
 AM_PATH_PYTHON(2.0,,:)
+AM_CONDITIONAL([HAVE_PYTHON], [test &quot;$PYTHON&quot; != :])
 
 AC_PROG_AWK
 AC_PROG_CC
Index: fetchmail/specgen.sh
===================================================================
--- fetchmail/specgen.sh	(revision 4465)
+++ fetchmail/specgen.sh	(working copy)
@@ -12,6 +12,8 @@
 
 cat &lt;&lt;EOF
 # Note: Do not hack fetchmail.spec by hand -- it's generated by specgen.sh
+%define with_python 1
+
 Name:		fetchmail
 Version:	$1
 Release:	1
@@ -104,6 +106,7 @@
 eller mailx. Der medf?lger ogs? et interaktivt GUI-baseret
 konfigurations-program, som kan bruges af almindelige brugere.
 
+%if %{with_python}
 %package -n fetchmailconf
 Summary:	A GUI configurator for generating fetchmail configuration files
 Summary(de):	GUI-Konfigurator f?r fetchmail
@@ -136,6 +139,7 @@
 
 %description -n fetchmailconf -l pl
 GUI konfigurator do fetchmaila napisany w pythonie.
+%endif
 
 %prep
 %setup -q
@@ -143,23 +147,22 @@
 %build
 LDFLAGS=&quot;-s&quot;
 export CFLAGS LDFLAGS
-#./configure --prefix=/usr --disable-nls --without-kerberos --mandir=%{_mandir} --with-SSL --enable-inet6
-./configure --prefix=/usr --without-included-gettext --without-kerberos --mandir=%{_mandir} --with-ssl --enable-inet6
-                         # Remove --disable-nls, add --without-included-gettext
-                         # for internationalization. Also look below.
+%configure --without-included-gettext --without-kerberos --with-ssl --enable-inet6
 make
 
 %install
-if [ -d \$RPM_BUILD_ROOT ]; then rm -rf \$RPM_BUILD_ROOT; fi
-mkdir -p \$RPM_BUILD_ROOT/{etc/X11/wmconfig,usr/lib/rhs/control-panel}
-make install-strip prefix=\$RPM_BUILD_ROOT/usr mandir=\$RPM_BUILD_ROOT%{_mandir}
+rm -rf \$RPM_BUILD_ROOT
+make install-strip DESTDIR=\$RPM_BUILD_ROOT
+
+%if %{with_python}
+mkdir -p \$RPM_BUILD_ROOT/usr/lib/rhs/control-panel
 cp rh-config/*.{xpm,init} \$RPM_BUILD_ROOT/usr/lib/rhs/control-panel
-rm -rf contrib/RCS
-chmod 644 contrib/*
+mkdir -p \$RPM_BUILD_ROOT/etc/X11/wmconfig
 cp rh-config/fetchmailconf.wmconfig \$RPM_BUILD_ROOT/etc/X11/wmconfig/fetchmailconf
-#cd \$RPM_BUILD_ROOT%{_mandir}/man1
-#ln -sf fetchmail.1 fetchmailconf.1
+%endif
 
+chmod 644 contrib/*
+
 %clean
 rm -rf \$RPM_BUILD_ROOT
 
@@ -171,18 +174,19 @@
 %doc fetchmail-features.html fetchmail-FAQ.html esrs-design-notes.html
 %doc design-notes.html
 %attr(644, root, man) %{_mandir}/man1/fetchmail.1*
-%attr(755, root, root) /usr/bin/fetchmail
-# Uncomment the following to support internationalization
-%attr(644,root,root) /usr/share/locale/*/LC_MESSAGES/fetchmail.mo
-# Uncomment the following to make split fetchmail and fetchmailconf packages
+%attr(755, root, root) %{_bindir}/fetchmail
+%attr(644,root,root) %{_datadir}/locale/*/LC_MESSAGES/fetchmail.mo
+
+%if %{with_python}
 %files -n fetchmailconf
 %defattr (644, root, root, 755)
 %attr(644,root,root) /etc/X11/wmconfig/fetchmailconf
-%attr(755,root,root) /usr/bin/fetchmailconf
+%attr(755,root,root) %{_bindir}/fetchmailconf
 %attr(644, root, man) %{_mandir}/man1/fetchmailconf.1*
 %attr(755,root,root) %{_prefix}/lib/python*/site-packages/fetchmailconf.py*
 /usr/lib/rhs/control-panel/fetchmailconf.xpm
 /usr/lib/rhs/control-panel/fetchmailconf.init
+%endif
 
 %changelog
 * `date '+%a %b %d %Y'` &lt;$email&gt; ${version}
Index: fetchmail/Makefile.am
===================================================================
--- fetchmail/Makefile.am	(revision 4465)
+++ fetchmail/Makefile.am	(working copy)
@@ -11,10 +11,15 @@
 BUILT_SOURCES=		rcfile_y.h
 
 bin_PROGRAMS=		fetchmail
+
+dist_noinst_SCRIPTS=	specgen.sh
+dist_man1_MANS=		fetchmail.man
+
+if HAVE_PYTHON
 nodist_bin_SCRIPTS=	fetchmailconf
 python_PYTHON=		fetchmailconf.py
-dist_noinst_SCRIPTS=	specgen.sh
-dist_man1_MANS=		fetchmail.man fetchmailconf.man
+dist_man1_MANS+=	fetchmailconf.man
+endif
 
 CLEANFILES=		$(nodist_bin_SCRIPTS)
 
@@ -94,8 +99,10 @@
 	    trio/CHANGES trio/README strlcpy.3 \
 	    m4-local/ac-archive-license.txt m4-local/ac_ma_search_package.m4
 
+if HAVE_PYTHON
 fetchmailconf:
 	( echo '#! /bin/sh' &amp;&amp; echo 'exec @PYTHON@ @pythondir@/fetchmailconf.py &quot;$$@&quot;' ) &gt;$@ || { rm -f $@ ; exit 1; }
+endif
 
 FAQ: fetchmail-FAQ.html
 	AWK=$(AWK) $(SHELL) $(srcdir)/dist-tools/html2txt $(srcdir)/fetchmail-FAQ.html &gt;$@ || { rm -f $@ ; exit 1 ; }
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000536.html">[fetchmail-devel] Contents of file `fetchmail-6.2.9-rc9.sq.po'
</A></li>
	<LI>Next message: <A HREF="000538.html">[fetchmail-devel] [PATCH] Re: Tried to install 6.2.9-rc8 --with-ssl
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#537">[ date ]</a>
              <a href="thread.html#537">[ thread ]</a>
              <a href="subject.html#537">[ subject ]</a>
              <a href="author.html#537">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/fetchmail-devel">More information about the fetchmail-devel
mailing list</a><br>
</body></html>
